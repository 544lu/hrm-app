<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <title>公司部门人员岗位信息</title>
    <!-- 浏览器标签图片 -->
    <link rel="shortcut icon" href="../../tag.jpg"/>
    <!-- FontAwesome字体图标 -->
    <link type="text/css" href="../../themes/font-awesome/css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../demo.css">
    <link type="text/css" href="../../themes/layui/css/layui.css" rel="stylesheet"/>
    <script type="text/javascript" src="../../jquery.min.js"></script>
    <script type="text/javascript" src="../../jquery.easyui.min.js"></script>
    <!-- layui框架js -->
    <script type="text/javascript" src="../../themes/layui/layui.js" charset="utf-8"></script>
</head>
<body>
<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'west',split:true" title="" style="width:18%;">
        <table title="" class="easyui-treegrid"
               data-options="
                url: 'http://localhost:8000/getListByLevelId',
                method: 'get',
                idField: 'id',
                treeField: 'text',
                onClickRow:changeIframe
            ">
            <thead>
            <tr>
                <th data-options="field:'text'" width="220">太平人寿保险有限公司佛山分公司</th>
            </tr>
            </thead>
        </table>
    </div>
    <div data-options="region:'center',title:'',iconCls:'icon-ok'">
        <div data-options="region:'north',fit:false,split:true,border:false"
             style="height:7%">
            <div class="easyui-panel" style="width:100%;border: none; text-align: right; padding:10px 60px;">
                <input class="easyui-searchbox"
                       data-options="prompt:'请输入查询内容',menu:'#mm',searcher:doSearch"
                       style="float:right;width:400px">
            </div>
            <div id="mm">
                <div data-options="name:'overall',iconCls:'fa fa-heart'">全局搜索</div>
                <div data-options="name:'keywords',iconCls:'fa fa-key'">关键字</div>
                <div data-options="name:'name',iconCls:'fa fa-user-o'">姓名</div>
            </div>
        </div>
        <div data-options="region:'center',title:'',fit:false,split:true,border:false,bodyCls:'border_right_bottom'"
             style="height:92%">
            <div class="easyui-tabs" data-options="fit:true,border:false,plain:true">
                <div title="员工信息" style="padding:5px">
                    <table id="productDg" class="easyui-datagrid"
                           data-options="url:'http://localhost:8000/getPageSet',method:'get',singleSelect:true,fit:true,fitColumns:true,pagination:true,toolbar:toolbar">
                        <thead>
                        <tr>
                            <th data-options="field:'employeeName',align:'center'" width="265">员工姓名</th>
                            <th data-options="field:'departmentName',align:'center'" width="265">部门</th>
                            <th data-options="field:'jobName',align:'center'" width="265">岗位</th>
                            <th data-options="field:'id',align:'center',formatter:operateFormatter"
                                width="265">操作
                            </th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="product-dialog"></div>
<script>
    function changeIframe(row) {

        console.log(row.levelId);
        var levelId = row.levelId;
        var id = row.id;
        if (levelId == 2 || levelId == 1) {
            var queryParams = $('#productDg').datagrid('options').queryParams;
            queryParams.name = "";
            queryParams.value = "";
            $("#productDg").datagrid({
                queryParams: {
                    id: "",
                }
            })
        } else {
            var queryParams = $('#productDg').datagrid('options').queryParams;
            queryParams.name = "";
            queryParams.value = "";
            $("#productDg").datagrid({
                queryParams: {
                    id: id,
                }
            })
            var queryParams = $('#productDg').datagrid('options').queryParams;
        }
    }

    function doSearch(value, name) {
        console.log(name + "==" + value);
        $('#productDg').datagrid({
            queryParams: {
                value: value,
                name: name
            }
        })
        $('#productDg').datagrid('load');
    }

    //菜单栏
    var toolbar = [{
        text:'添加',
        iconCls:'icon-add',
        handler:function(){
            var productWin = $('#product-dialog').dialog({
                width: 950,
                height: 500,
                href: '/hrm-web/html/layout/insert-page.html',
                title: '添加人员',
                closed: true,
                minimizable: false,
                collapsible: false,
                maximizable: false,
                cache: false,
                shadow: false
            });
            productWin.dialog('clear');
            productWin.dialog('open');
        }
    }];

    function operateFormatter(value, row, index) {
        var str = '<a href="#" name="opera" class="easyui-linkbutton" style="color: #00a65a" onclick="clickBtn(' + row.id + ')"><i class="fa fa-eye" aria-hidden="true"></i></a>';
        return str;
    }

    function clickBtn(id) {
        console.log(id);
        var productWin = $('#product-dialog').dialog({
            width: 950,
            height: 500,
            href: '/hrm-web/html/layout/multiline.html',
            onOpen: function () {
                var rm=Math.random();
                $.ajax({
                    url: 'http://localhost:8000/getById?id=' + id+'&random='+rm,
                    dataType: "json",
                    success: function (data) {
                        console.log(data.employeeName);
                        $('#employeeName').textbox('setText', data.employeeName);
                        $('#deptName').textbox('setText', data.deptName);
                        $('#jobName').textbox('setText', data.jobName);
                        if (data.mainWork1) {
                            $('#mainWork1').textbox('setText', data.mainWork1);
                            $('#mainWorkDes1').textbox('setText', data.mainWorkDes1);
                        } else {
                            $('#southTabs').tabs('close', '主要工作1');
                        }
                        if (data.mainWork2) {
                            $('#mainWork2').textbox('setText', data.mainWork2);
                            $('#mainWorkDes2').textbox('setText', data.mainWorkDes2);
                        } else {
                            $('#southTabs').tabs('close', '主要工作2');
                        }
                        if (data.mainWork3) {
                            $('#mainWork3').textbox('setText', data.mainWork3);
                            $('#mainWorkDes3').textbox('setText', data.mainWorkDes3);
                        } else {
                            $('#southTabs').tabs('close', '主要工作3');
                        }
                        if (data.mainWork4) {
                            $('#mainWork4').textbox('setText', data.mainWork4);
                            $('#mainWorkDes4').textbox('setText', data.mainWorkDes4);
                        } else {
                            $('#southTabs').tabs('close', '主要工作4');
                        }
                        if (data.mainWork5) {
                            $('#mainWork5').textbox('setText', data.mainWork5);
                            $('#mainWorkDes5').textbox('setText', data.mainWorkDes5);
                        } else {
                            $('#southTabs').tabs('close', '主要工作5');
                        }
                        if (data.mainWork6) {
                            $('#mainWork6').textbox('setText', data.mainWork6);
                            $('#mainWorkDes6').textbox('setText', data.mainWorkDes6);
                        } else {
                            $('#southTabs').tabs('close', '主要工作6');
                        }
                        if (data.mainWork7) {
                            $('#mainWork7').textbox('setText', data.mainWork7);
                            $('#mainWorkDes7').textbox('setText', data.mainWorkDes7);
                        } else {
                            $('#southTabs').tabs('close', '主要工作7');
                        }
                        if (data.mainWork8) {
                            $('#mainWork8').textbox('setText', data.mainWork8);
                            $('#mainWorkDes8').textbox('setText', data.mainWorkDes8);
                        } else {
                            $('#southTabs').tabs('close', '主要工作8');
                        }
                    }
                });
            },
            title: '查看信息',
            closed: true,
            minimizable: false,
            collapsible: false,
            maximizable: false,
            cache: false,
            shadow: false
        });
        productWin.dialog('clear');
        productWin.dialog('open');
    }
</script>
</body>
</html>